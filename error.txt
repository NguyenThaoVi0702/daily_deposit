-- This subquery now safely handles duplicate rates for the same day
SELECT
    conversion_date,
    from_currency,
    conversion_rate
FROM (
    SELECT
        conversion_date,
        from_currency,
        CAST(conversion_rate AS double) AS conversion_rate,
        ROW_NUMBER() OVER(
            PARTITION BY conversion_date, from_currency 
            ORDER BY your_timestamp_or_id_column DESC -- <-- IMPORTANT: Replace this column!
        ) as rn
    FROM
        ogl.ogl_gl_daily_rates
    WHERE
        conversion_date >= '2024-12-09'
        AND conversion_type = '1009'
        AND to_currency = 'VND'
)
WHERE 
    rn = 1
